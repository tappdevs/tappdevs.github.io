function loadScript(url,callback){var head=document.head;var script=document.createElement("script");script.type="text/javascript";script.src=url;script.onreadystatechange=callback;script.onload=callback;head.appendChild(script);}
function loadScripts(urls,callback){var loadedCount=0;var multiCallback=function(){loadedCount++;if(loadedCount>=urls.length){callback.call(this,arguments);}};for(var url of urls){loadScript(url,multiCallback);}}
var getJSON=function(url,callback){var xhr=new XMLHttpRequest();xhr.open("GET",url,true);xhr.responseType="json";xhr.onload=function(){var status=xhr.status;if(status===200){callback(null,xhr.response);}else{callback(status);}};xhr.send();};window.chartColors={red:"#ED1C24",orange:"#F7941E",yellow:"rgb(255, 205, 86)",green:"#8DC63F",blue:"#398DD3",purple:"rgb(153, 102, 255)",grey:"rgb(201, 203, 207)",};function preprocessData(_cramstackData){dates=_cramstackData.daily_count.map((each)=>{return each["Date"].toString();});cumulative_Confirmed_Cases=_cramstackData.daily_count.map((each)=>{return each["Cumulative_Confirmed_Cases"];});cumulative_Death=_cramstackData.daily_count.map((each)=>{return each["Cumulative_Death"];});cumulative_Recovery=_cramstackData.daily_count.map((each)=>{return each["Cumulative_Recovery"];});total_Tests_for_COVID19=_cramstackData.daily_vs_confirmed_cases.map((each)=>{return each["Total_Tests_for_COVID19_"];});return{dates,cumulative_Death,cumulative_Recovery,cumulative_Confirmed_Cases,total_Tests_for_COVID19,};}
function initChartData(dates,cumulative_Confirmed_Cases,cumulative_Recovery,cumulative_Death,total_Tests_for_COVID19){var chartData={labels:dates,datasets:[{type:"bar",label:"সংক্রমিত ব্যক্তির সংখ্যা",backgroundColor:window.chartColors.yellow,data:cumulative_Confirmed_Cases,},{type:"bar",label:"মৃত্যু",backgroundColor:window.chartColors.red,data:cumulative_Death,},{type:"line",label:"সুস্থ হয়েছেন",data:cumulative_Recovery,borderColor:window.chartColors.green,borderWidth:2,fill:false,},],};var lineChartData1={labels:dates,datasets:[{type:"line",label:"আক্রান্ত ব্যক্তির সংখ্যা",borderColor:window.chartColors.yellow,fill:false,data:cumulative_Confirmed_Cases,},],};var lineChartData2={labels:dates,datasets:[{type:"line",label:"সুস্থ ব্যক্তির সংখ্যা",borderColor:window.chartColors.green,fill:false,data:cumulative_Recovery,},],};var lineChartData3={labels:dates,datasets:[{type:"line",label:"মৃত ব্যক্তির সংখ্যা",borderColor:window.chartColors.red,fill:false,data:cumulative_Death,},],};var lineChartData4={labels:dates,datasets:[{type:"line",label:"পরিক্ষাকৃত নমুনার সংখ্যা",borderColor:window.chartColors.blue,fill:false,data:total_Tests_for_COVID19,},],};return{barChartData:chartData,lineChartData1,lineChartData2,lineChartData3,lineChartData4,};}
function processTimeData(datasets,labels){datasets=datasets.map((b)=>{b.data=b.data.map((d,i)=>{var dayStr=labels[i];var day=moment(dayStr);return{t:day.toDate(),y:d};});return b;});return datasets;}
function drawChart(data){var barChartCtx=document.getElementById("barChart");data.barChartData.datasets=processTimeData(data.barChartData.datasets,data.barChartData.labels);data.lineChartData1.datasets=processTimeData(data.lineChartData1.datasets,data.lineChartData1.labels);data.lineChartData2.datasets=processTimeData(data.lineChartData2.datasets,data.lineChartData2.labels);data.lineChartData3.datasets=processTimeData(data.lineChartData3.datasets,data.lineChartData3.labels);data.lineChartData4.datasets=processTimeData(data.lineChartData4.datasets,data.lineChartData4.labels);var barChart=new Chart(barChartCtx,{type:"bar",data:data.barChartData,options:{options:{responsive:true,title:{display:true,},tooltips:{mode:"index",intersect:true,},},scales:{xAxes:[{type:"time",distribution:"series",},],yAxes:[{ticks:{beginAtZero:true,},},],},},});var lineChartDefaultOptions={tooltips:{mode:"index",intersect:false,},elements:{point:{radius:0},line:{tension:0}},scales:{yAxes:[{ticks:{display:false,beginAtZero:true,},gridLines:{display:false,},},],xAxes:[{type:"time",distribution:"series",ticks:{display:false,beginAtZero:true,},gridLines:{display:false,},},],},legend:{display:false,},};var lineChartCtx1=document.getElementById("temp1");var lineChart1=new Chart(lineChartCtx1,{type:"line",data:data.lineChartData1,options:lineChartDefaultOptions,});var lineChartCtx2=document.getElementById("temp2");var lineChart2=new Chart(lineChartCtx2,{type:"line",data:data.lineChartData2,options:lineChartDefaultOptions,});var lineChartCtx3=document.getElementById("temp3");var lineChart3=new Chart(lineChartCtx3,{type:"line",data:data.lineChartData3,options:lineChartDefaultOptions,});var lineChartCtx4=document.getElementById("temp4");var lineChart4=new Chart(lineChartCtx4,{type:"line",data:data.lineChartData4,options:lineChartDefaultOptions,});}
var dataSetUpdate=function(_cramstackData){document.getElementById("c1v").textContent=_cramstackData.today_daily_count[0].Confirmed_Cases_in_Last_24_Hour;document.getElementById("c2v").textContent=_cramstackData.today_daily_count[0].Recovery_in_Last_24_Hour;document.getElementById("c3v").textContent=_cramstackData.today_daily_count[0].Death_in_Last_24_Hour;document.getElementById("c4v").textContent=_cramstackData.today_daily_vs_confirmed_cases[0].Daily_Tests_for_COVID19_;document.getElementById("c5v").textContent=_cramstackData.today_daily_count[0].Cumulative_Confirmed_Cases;document.getElementById("c6v").textContent=_cramstackData.today_daily_count[0].Cumulative_Recovery;document.getElementById("c7v").textContent=_cramstackData.today_daily_count[0].Cumulative_Death;document.getElementById("c8v").textContent=_cramstackData.today_daily_vs_confirmed_cases[0].Total_Tests_for_COVID19_;let Pct_Change_Cumulative_Confirmed_Cases=_cramstackData.today_daily_count[0].Pct_Change_Cumulative_Confirmed_Cases*100;Pct_Change_Cumulative_Confirmed_Cases=Pct_Change_Cumulative_Confirmed_Cases.toFixed(2);let Pct_Change_Cumulative_Confirmed_Cases_Symbol=Pct_Change_Cumulative_Confirmed_Cases>0?'<i class="fa fa-long-arrow-up color-red aria-hidden="true"></i>':'<i class="fa fa-long-arrow-down color-green aria-hidden="true"></i>';let Pct_Change_Cumulative_Recovery=_cramstackData.today_daily_count[0].Pct_Change_Cumulative_Recovery*100;Pct_Change_Cumulative_Recovery=Pct_Change_Cumulative_Recovery.toFixed(2);let Pct_Change_Cumulative_Recovery_Symbol=Pct_Change_Cumulative_Recovery>0?'<i class="fa fa-long-arrow-up color-green aria-hidden="true"></i>':'<i class="fa fa-long-arrow-down color-red aria-hidden="true"></i>';let Pct_Change_Cumulative_Death=_cramstackData.today_daily_count[0].Pct_Change_Cumulative_Death*100;Pct_Change_Cumulative_Death=Pct_Change_Cumulative_Death.toFixed(2);let Pct_Change_Cumulative_Death_Symbol=Pct_Change_Cumulative_Death>0?'<i class="fa fa-long-arrow-up color-red aria-hidden="true"></i>':'<i class="fa fa-long-arrow-down color-green aria-hidden="true"></i>';let Pct_Change_in_Total_Tests_for_COVID19=_cramstackData.today_daily_vs_confirmed_cases[0].Pct_Change_in_Total_Tests_for_COVID19*100;Pct_Change_in_Total_Tests_for_COVID19=Pct_Change_in_Total_Tests_for_COVID19.toFixed(2);let Pct_Change_in_Total_Tests_for_COVID19_Symbol=Pct_Change_in_Total_Tests_for_COVID19>0?'<i class="fa fa-long-arrow-up color-green aria-hidden="true"></i>':'<i class="fa fa-long-arrow-down color-red aria-hidden="true"></i>';document.getElementById("c5p").textContent=Pct_Change_Cumulative_Confirmed_Cases+"%";document.getElementById("c5p").innerHTML+=Pct_Change_Cumulative_Confirmed_Cases_Symbol;document.getElementById("c6p").textContent=Pct_Change_Cumulative_Recovery+"%";document.getElementById("c6p").innerHTML+=Pct_Change_Cumulative_Recovery_Symbol;document.getElementById("c7p").textContent=Pct_Change_Cumulative_Death+"%";document.getElementById("c7p").innerHTML+=Pct_Change_Cumulative_Death_Symbol;document.getElementById("c8p").textContent=Pct_Change_in_Total_Tests_for_COVID19+"%";document.getElementById("c8p").innerHTML+=Pct_Change_in_Total_Tests_for_COVID19_Symbol;};loadScripts(["https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js","https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js","https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@0.1.1",],function(){getJSON("https://corona-api.cramstack.com/",function(err,data){if(err!=null){console.error("can not load corona api data");}else{var cramstackData=preprocessData(data);var chartData=initChartData(cramstackData.dates,cramstackData.cumulative_Confirmed_Cases,cramstackData.cumulative_Recovery,cramstackData.cumulative_Death,cramstackData.total_Tests_for_COVID19);drawChart(chartData);dataSetUpdate(data);}});});